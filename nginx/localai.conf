map $http_origin $cors_origin {
    default                          "";
    "~^http://localhost:5500$"       $http_origin;
    "~^http://127\.0\.0\.1:5500$"    $http_origin;
}

server {
    listen 80;
    server_name _;

    add_header Access-Control-Allow-Origin  $cors_origin           always;
    add_header Access-Control-Allow-Methods "GET,POST,PUT,PATCH,DELETE,OPTIONS" always;
    add_header Access-Control-Allow-Headers "Authorization,Content-Type"        always;
    add_header Access-Control-Max-Age       86400                  always;
    add_header Access-Control-Expose-Headers "Content-Type,Authorization" always;
    add_header Vary "Origin" always;

    location / {
        if ($request_method = OPTIONS) {
            return 204;
        }

        proxy_pass http://localai:8080;
        proxy_set_header Host              $host;
        proxy_set_header X-Forwarded-For   $remote_addr;

        proxy_set_header Authorization "Bearer MINHA_CHAVE_SECRETA";
    }
}
